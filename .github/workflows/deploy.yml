name: Deploy to Digital Ocean

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Deploy to server
      uses: appleboy/ssh-action@v1.0.3
      with:
        host: 64.227.187.111
        username: root
        key: ${{ secrets.DEPLOY_SSH_KEY }}
        script: |
          echo "ğŸš€ Starting deployment..."

          # Navigate to project directory
          cd /root/seo-schema-generator

          # Pull latest changes
          echo "ğŸ“¥ Pulling latest changes from GitHub..."
          git pull origin main

          # Install dependencies (including dev dependencies for build)
          echo "ğŸ“¦ Installing dependencies..."
          npm install

          # Build frontend
          echo "ğŸ”¨ Building frontend..."
          npm run build

          # Copy to web directory
          echo "ğŸ“‹ Copying files to web directory..."
          sudo cp -r dist/* /var/www/seo-schema-generator/
          sudo chown -R www-data:www-data /var/www/seo-schema-generator

          # Restart PM2 backend
          echo "ğŸ”„ Restarting backend..."
          pm2 restart seo-schema-generator-api

          echo "âœ… Deployment complete!"
          echo "ğŸŒ Frontend: https://seo.xopenai.in"
          echo "ğŸ”§ Backend: Running on port 3007"
